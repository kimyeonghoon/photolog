# Photolog ë°±ì—”ë“œ Docker Compose ê´€ë¦¬ Makefile

.PHONY: help build up down restart logs clean dev prod status

# ê¸°ë³¸ íƒ€ê²Ÿ
help:
	@echo "ğŸ³ Photolog ë°±ì—”ë“œ Docker Compose ëª…ë ¹ì–´"
	@echo ""
	@echo "ê°œë°œ í™˜ê²½:"
	@echo "  make dev        - ê°œë°œ í™˜ê²½ ì‹œì‘ (ë¹Œë“œ + ì‹¤í–‰)"
	@echo "  make up         - ì»¨í…Œì´ë„ˆ ì‹¤í–‰"
	@echo "  make down       - ì»¨í…Œì´ë„ˆ ì¤‘ì§€"
	@echo "  make restart    - ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘"
	@echo "  make build      - ì´ë¯¸ì§€ ë¹Œë“œ"
	@echo ""
	@echo "ìš´ì˜ í™˜ê²½:"
	@echo "  make prod       - ìš´ì˜ í™˜ê²½ ì‹œì‘"
	@echo "  make prod-down  - ìš´ì˜ í™˜ê²½ ì¤‘ì§€"
	@echo ""
	@echo "ê´€ë¦¬:"
	@echo "  make logs       - ë¡œê·¸ í™•ì¸"
	@echo "  make logs-f     - ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸"
	@echo "  make status     - ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸"
	@echo "  make clean      - ëª¨ë“  ì»¨í…Œì´ë„ˆ/ì´ë¯¸ì§€ ì •ë¦¬"
	@echo ""

# ê°œë°œ í™˜ê²½
dev: build up

build:
	@echo "ğŸ“¦ ë°±ì—”ë“œ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì¤‘..."
	docker compose build

up:
	@echo "ğŸš€ ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì‹œì‘ ì¤‘..."
	docker compose up -d

down:
	@echo "ğŸ›‘ ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì¤‘..."
	docker compose down

restart: down up

# ìš´ì˜ í™˜ê²½
prod:
	@echo "ğŸš€ ë°±ì—”ë“œ ìš´ì˜ í™˜ê²½ ì‹œì‘ ì¤‘..."
	docker compose -f docker-compose.prod.yml up -d --build

prod-down:
	@echo "ğŸ›‘ ë°±ì—”ë“œ ìš´ì˜ í™˜ê²½ ì¤‘ì§€ ì¤‘..."
	docker compose -f docker-compose.prod.yml down

# ë¡œê·¸ ë° ìƒíƒœ
logs:
	docker compose logs photolog-backend

logs-f:
	docker compose logs -f photolog-backend

status:
	@echo "ğŸ“Š ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ìƒíƒœ:"
	docker compose ps
	@echo ""
	@echo "ğŸ“Š ë°±ì—”ë“œ ì´ë¯¸ì§€:"
	docker images | grep photolog-backend

# ì •ë¦¬
clean:
	@echo "ğŸ§¹ Docker ì •ë¦¬ ì¤‘..."
	docker compose down -v --rmi all
	docker system prune -f

# í—¬ìŠ¤ì²´í¬
health:
	@echo "ğŸ” ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬:"
	@curl -s http://localhost:8001/health | jq . || echo "ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨"