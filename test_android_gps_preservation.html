<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆë“œë¡œì´ë“œ GPS ë³´ì¡´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }

        .test-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .result {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .android {
            background: #4CAF50;
        }

        .ios {
            background: #FF9800;
        }

        .desktop {
            background: #9C27B0;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>ğŸ“± ì•ˆë“œë¡œì´ë“œ GPS ë³´ì¡´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>

    <div class="test-section">
        <h2>1. ê¸°ê¸° ê°ì§€ í…ŒìŠ¤íŠ¸</h2>
        <p>í˜„ì¬ User Agentë¥¼ ë¶„ì„í•˜ì—¬ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testDeviceDetection()">ê¸°ê¸° ê°ì§€ í…ŒìŠ¤íŠ¸</button>
        <div id="device-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. User Agent ì‹œë®¬ë ˆì´ì…˜</h2>
        <p>ë‹¤ì–‘í•œ ê¸°ê¸°ì˜ User Agentë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ ê°ì§€ ë¡œì§ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button class="android" onclick="simulateUserAgent('android')">ì•ˆë“œë¡œì´ë“œ ì‹œë®¬ë ˆì´ì…˜</button>
        <button class="ios" onclick="simulateUserAgent('ios')">iOS ì‹œë®¬ë ˆì´ì…˜</button>
        <button class="desktop" onclick="simulateUserAgent('desktop')">ë°ìŠ¤í¬í†± ì‹œë®¬ë ˆì´ì…˜</button>
        <div id="simulation-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. GPS ë³´ì¡´ ì •ì±… í…ŒìŠ¤íŠ¸</h2>
        <p>ê¸°ê¸°ë³„ë¡œ require_metadata_first ì˜µì…˜ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testGPSPreservationPolicy()">GPS ë³´ì¡´ ì •ì±… í…ŒìŠ¤íŠ¸</button>
        <div id="gps-policy-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜</h2>
        <p>ì‹¤ì œ API í˜¸ì¶œì—ì„œ require_metadata_first íŒŒë¼ë¯¸í„°ê°€ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="simulateAPICall()">API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜</button>
        <div id="api-result" class="result"></div>
    </div>

    <script>
        // ê¸°ê¸° ê°ì§€ ìœ í‹¸ë¦¬í‹° (ì‹¤ì œ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œì™€ ë™ì¼)
        function isAndroidDevice() {
            const userAgent = navigator.userAgent || '';
            const hasAndroid = /Android/i.test(userAgent);
            const isMobileChrome = /Chrome/.test(userAgent) && /Mobile/.test(userAgent);
            return hasAndroid || (isMobileChrome && hasAndroid);
        }

        function requiresMetadataFirst() {
            return isAndroidDevice();
        }

        function logDeviceInfo() {
            const isAndroid = isAndroidDevice();
            const needsMetadataFirst = requiresMetadataFirst();

            return {
                userAgent: navigator.userAgent,
                isAndroid,
                needsMetadataFirst,
                platform: navigator.platform,
                vendor: navigator.vendor
            };
        }

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testDeviceDetection() {
            const deviceInfo = logDeviceInfo();
            const result = document.getElementById('device-result');

            result.innerHTML = `í˜„ì¬ ê¸°ê¸° ì •ë³´:
User Agent: ${deviceInfo.userAgent}
Platform: ${deviceInfo.platform}
Vendor: ${deviceInfo.vendor}
ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°: ${deviceInfo.isAndroid ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}
GPS ë³´ì¡´ í•„ìš”: ${deviceInfo.needsMetadataFirst ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}`;

            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${deviceInfo.isAndroid ? 'success' : 'warning'}`;
            statusDiv.textContent = deviceInfo.isAndroid
                ? 'âœ… ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ê°€ ê°ì§€ë˜ì–´ GPS ë³´ì¡´ ëª¨ë“œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.'
                : 'âš ï¸ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ê°€ ì•„ë‹ˆë¯€ë¡œ ì¼ë°˜ ì—…ë¡œë“œ ëª¨ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.';

            result.appendChild(statusDiv);
        }

        function simulateUserAgent(deviceType) {
            const userAgents = {
                android: 'Mozilla/5.0 (Linux; Android 13; SM-G998B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36',
                ios: 'Mozilla/5.0 (iPhone; CPU iPhone OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1',
                desktop: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
            };

            const originalUserAgent = navigator.userAgent;

            // User Agent ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ í•¨ìˆ˜
            function testWithUserAgent(ua) {
                const hasAndroid = /Android/i.test(ua);
                const isMobileChrome = /Chrome/.test(ua) && /Mobile/.test(ua);
                const isAndroid = hasAndroid || (isMobileChrome && hasAndroid);
                const needsMetadataFirst = isAndroid;

                return {
                    userAgent: ua,
                    isAndroid,
                    needsMetadataFirst
                };
            }

            const testResult = testWithUserAgent(userAgents[deviceType]);
            const result = document.getElementById('simulation-result');

            result.innerHTML = `${deviceType.toUpperCase()} ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼:
User Agent: ${testResult.userAgent}
ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°: ${testResult.isAndroid ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}
GPS ë³´ì¡´ í•„ìš”: ${testResult.needsMetadataFirst ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}`;

            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${testResult.isAndroid ? 'success' : 'warning'}`;
            statusDiv.textContent = testResult.isAndroid
                ? 'âœ… ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ë¡œ ê°ì§€ë˜ì–´ require_metadata_first=trueê°€ ì„¤ì •ë©ë‹ˆë‹¤.'
                : 'âš ï¸ ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°ê°€ ì•„ë‹ˆë¯€ë¡œ require_metadata_first=falseê°€ ì„¤ì •ë©ë‹ˆë‹¤.';

            result.appendChild(statusDiv);
        }

        function testGPSPreservationPolicy() {
            const devices = [
                { name: 'ê°¤ëŸ­ì‹œ S23', ua: 'Mozilla/5.0 (Linux; Android 13; SM-G998B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36' },
                { name: 'í”½ì…€ 7', ua: 'Mozilla/5.0 (Linux; Android 14; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36' },
                { name: 'iPhone 15', ua: 'Mozilla/5.0 (iPhone; CPU iPhone OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1' },
                { name: 'iPad', ua: 'Mozilla/5.0 (iPad; CPU OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1' },
                { name: 'Chrome ë°ìŠ¤í¬í†±', ua: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36' }
            ];

            let testResults = 'ê¸°ê¸°ë³„ GPS ë³´ì¡´ ì •ì±… í…ŒìŠ¤íŠ¸ ê²°ê³¼:\\n\\n';

            devices.forEach(device => {
                const hasAndroid = /Android/i.test(device.ua);
                const isMobileChrome = /Chrome/.test(device.ua) && /Mobile/.test(device.ua);
                const isAndroid = hasAndroid || (isMobileChrome && hasAndroid);
                const needsMetadataFirst = isAndroid;

                testResults += `${device.name}:
  ì•ˆë“œë¡œì´ë“œ: ${isAndroid ? 'YES' : 'NO'}
  require_metadata_first: ${needsMetadataFirst ? 'TRUE' : 'FALSE'}
  ì •ì±…: ${needsMetadataFirst ? 'GPS ë³´ì¡´ ëª¨ë“œ' : 'ì¼ë°˜ ì—…ë¡œë“œ ëª¨ë“œ'}

`;
            });

            document.getElementById('gps-policy-result').textContent = testResults;
        }

        function simulateAPICall() {
            const currentDevice = logDeviceInfo();

            // API í˜¸ì¶œ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
            const mockFileData = {
                file: 'data:image/jpeg;base64,/9j/4AAQ...',
                description: 'GPS ë³´ì¡´ í…ŒìŠ¤íŠ¸',
                thumbnails: {},
                exifData: {
                    timestamp: '2023-08-15T14:30:00Z',
                    latitude: 33.5563,
                    longitude: 126.7958
                },
                location: {
                    latitude: 33.5563,
                    longitude: 126.7958
                },
                require_metadata_first: currentDevice.needsMetadataFirst
            };

            const apiRequest = {
                method: 'POST',
                files: [mockFileData]
            };

            const result = document.getElementById('api-result');
            result.innerHTML = `API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜:

ìš”ì²­ ë°ì´í„°:
${JSON.stringify(apiRequest, null, 2)}

ê¸°ê¸° ê°ì§€ ê²°ê³¼:
- ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°: ${currentDevice.isAndroid ? 'YES' : 'NO'}
- require_metadata_first: ${currentDevice.needsMetadataFirst ? 'TRUE' : 'FALSE'}

ë°±ì—”ë“œ ì²˜ë¦¬ ì˜ˆìƒ:
${currentDevice.needsMetadataFirst
    ? 'ğŸ“± ì•ˆë“œë¡œì´ë“œ ê¸°ê¸° ê°ì§€: GPS ë³´ì¡´ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„° ìš°ì„  ì €ì¥ ëª¨ë“œ í™œì„±í™”'
    : 'ğŸ’» ì¼ë°˜ ê¸°ê¸°: í‘œì¤€ ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤ ì‚¬ìš©'
}`;

            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${currentDevice.needsMetadataFirst ? 'success' : 'warning'}`;
            statusDiv.textContent = currentDevice.needsMetadataFirst
                ? 'âœ… GPS ë³´ì¡´ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„° ìš°ì„  ì €ì¥ì´ ì ìš©ë©ë‹ˆë‹¤.'
                : 'âš ï¸ ì¼ë°˜ ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.';

            result.appendChild(statusDiv);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ê¸°ê¸° ê°ì§€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.onload = function() {
            testDeviceDetection();
        };
    </script>
</body>
</html>